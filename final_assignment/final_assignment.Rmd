---
author: "Study Group 11: Nereid Kwok, Nisa Ozer, Lauren Wade, Thomas Giannetti-Fakhouri, Kazmer Nagy-Betegh, Chandrime Tolia"

title: "Final Assignment"

date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    highlight: zenburn
    number_sections: yes
    toc: yes
    toc_float: yes
    code_folding: show
    df_print: paged
---

```{r , echo=FALSE}
#hi
#hi2

knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)


# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center"
)
```

```{r initialise-libraries, echo=FALSE}

library(googlesheets4)
library(tidyverse)
library(janitor) 
library(skimr)
library(countrycode) # to clean up country names
library(broom)
library(car)
library(ggfortify)
library(lubridate)
library(labourR)
library(magrittr)
```



# Data Import

```{r import-ask-manager}

# Google Sheets permissions did not work with my google account

# # use googlesheets4 to get data
# url <- "https://docs.google.com/spreadsheets/d/1IPS5dBSGtwYVbjsfbaMCYIWnOuRmJcbequohNxCyGVw/edit?resourcekey#gid=1625408792"
# googlesheets4::gs4_auth() # google sheets authorisation
# 
# # load "Ask a A Manager 2021 Survey" googlesheet
# # https://www.askamanager.org/
# ask_a_manager_2021 <- googlesheets4::read_sheet(url) %>% 
#   janitor::clean_names()

# if googlesheets is now working, read local copy
ask_a_manager_2021 <- read_csv(here::here("data", "ask_a_manager_2021.csv"))%>%
  janitor::clean_names()
  
```

# Intitial Data Exploration and Cleaning

Hiii 

```{r data-explore}

skimr::skim(ask_a_manager_2021)

head(ask_a_manager_2021)
```

### Clean Country Names

```{r country-code-cleaning}

# unique(ask_a_manager_2021$country) # checking the list of unique country codes reveals that country names are inconsistent across the data

ask_a_manager_2021 <- ask_a_manager_2021%>%
  mutate(
    country = countrycode::countrycode(sourcevar = ask_a_manager_2021$country, 
                                       origin = 'country.name', 
                                       destination = 'country.name', 
                                       warn = TRUE, 
                                       nomatch = NULL)
    )
```

### Clasify Jobs and Industries

```{r check-after-cleaning}
# skimr::skim(ask_a_manager_2021)

# unique(ask_a_manager_2021$industry)

ask_a_manager_2021 <- ask_a_manager_2021%>%
  mutate(job_ind = paste(job_title, industry, sep = " "))

occupation_classification <- labourR::classify_occupation(corpus = ask_a_manager_2021, 
                                         isco_level = 2, 
                                         lang = "en",
                                         num_leaves = 10,
                                         text_col = "job_ind",
                                         id = "timestamp")%>%
  mutate(timestamp = ymd_hms(timestamp))
  

 
ask_a_manager_2021 <- left_join(ask_a_manager_2021,
          occupation_classification,
          by = "timestamp")%>%
  clean_names()

```

```{r}


```


```{r}


```

